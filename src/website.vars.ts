function f(t: string) {
    return /[\u0080-\uFFFF]/.test(t) && (t = unescape(encodeURIComponent(t))), t;
}

export const e = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'b', 'c', 'd', 'e', 'f'];
function d(t: number) {
    var n: number, s = "";
    for (n = 0; n < 4; n += 1)
        s += e[t >> 8 * n + 4 & 15] + e[t >> 8 * n & 15];
    return s
}

function h(t: any[]) {
    var i: number;
    for (i = 0; i < t.length; i += 1)
        t[i] = d(t[i]);
    return t.join("")
}

// encrypt
function n(t: any[], e: any[]) {
    var a = t[0]
        , b = t[1]
        , n = t[2]
        , o = t[3];
    b = ((b += ((n = ((n += ((o = ((o += ((a = ((a += (b & n | ~b & o) + e[0] - 680876936 | 0) << 7 | a >>> 25) + b | 0) & b | ~a & n) + e[1] - 389564586 | 0) << 12 | o >>> 20) + a | 0) & a | ~o & b) + e[2] + 606105819 | 0) << 17 | n >>> 15) + o | 0) & o | ~n & a) + e[3] - 1044525330 | 0) << 22 | b >>> 10) + n | 0,
        b = ((b += ((n = ((n += ((o = ((o += ((a = ((a += (b & n | ~b & o) + e[4] - 176418897 | 0) << 7 | a >>> 25) + b | 0) & b | ~a & n) + e[5] + 1200080426 | 0) << 12 | o >>> 20) + a | 0) & a | ~o & b) + e[6] - 1473231341 | 0) << 17 | n >>> 15) + o | 0) & o | ~n & a) + e[7] - 45705983 | 0) << 22 | b >>> 10) + n | 0,
        b = ((b += ((n = ((n += ((o = ((o += ((a = ((a += (b & n | ~b & o) + e[8] + 1770035416 | 0) << 7 | a >>> 25) + b | 0) & b | ~a & n) + e[9] - 1958414417 | 0) << 12 | o >>> 20) + a | 0) & a | ~o & b) + e[10] - 42063 | 0) << 17 | n >>> 15) + o | 0) & o | ~n & a) + e[11] - 1990404162 | 0) << 22 | b >>> 10) + n | 0,
        b = ((b += ((n = ((n += ((o = ((o += ((a = ((a += (b & n | ~b & o) + e[12] + 1804603682 | 0) << 7 | a >>> 25) + b | 0) & b | ~a & n) + e[13] - 40341101 | 0) << 12 | o >>> 20) + a | 0) & a | ~o & b) + e[14] - 1502002290 | 0) << 17 | n >>> 15) + o | 0) & o | ~n & a) + e[15] + 1236535329 | 0) << 22 | b >>> 10) + n | 0,
        b = ((b += ((n = ((n += ((o = ((o += ((a = ((a += (b & o | n & ~o) + e[1] - 165796510 | 0) << 5 | a >>> 27) + b | 0) & n | b & ~n) + e[6] - 1069501632 | 0) << 9 | o >>> 23) + a | 0) & b | a & ~b) + e[11] + 643717713 | 0) << 14 | n >>> 18) + o | 0) & a | o & ~a) + e[0] - 373897302 | 0) << 20 | b >>> 12) + n | 0,
        b = ((b += ((n = ((n += ((o = ((o += ((a = ((a += (b & o | n & ~o) + e[5] - 701558691 | 0) << 5 | a >>> 27) + b | 0) & n | b & ~n) + e[10] + 38016083 | 0) << 9 | o >>> 23) + a | 0) & b | a & ~b) + e[15] - 660478335 | 0) << 14 | n >>> 18) + o | 0) & a | o & ~a) + e[4] - 405537848 | 0) << 20 | b >>> 12) + n | 0,
        b = ((b += ((n = ((n += ((o = ((o += ((a = ((a += (b & o | n & ~o) + e[9] + 568446438 | 0) << 5 | a >>> 27) + b | 0) & n | b & ~n) + e[14] - 1019803690 | 0) << 9 | o >>> 23) + a | 0) & b | a & ~b) + e[3] - 187363961 | 0) << 14 | n >>> 18) + o | 0) & a | o & ~a) + e[8] + 1163531501 | 0) << 20 | b >>> 12) + n | 0,
        b = ((b += ((n = ((n += ((o = ((o += ((a = ((a += (b & o | n & ~o) + e[13] - 1444681467 | 0) << 5 | a >>> 27) + b | 0) & n | b & ~n) + e[2] - 51403784 | 0) << 9 | o >>> 23) + a | 0) & b | a & ~b) + e[7] + 1735328473 | 0) << 14 | n >>> 18) + o | 0) & a | o & ~a) + e[12] - 1926607734 | 0) << 20 | b >>> 12) + n | 0,
        b = ((b += ((n = ((n += ((o = ((o += ((a = ((a += (b ^ n ^ o) + e[5] - 378558 | 0) << 4 | a >>> 28) + b | 0) ^ b ^ n) + e[8] - 2022574463 | 0) << 11 | o >>> 21) + a | 0) ^ a ^ b) + e[11] + 1839030562 | 0) << 16 | n >>> 16) + o | 0) ^ o ^ a) + e[14] - 35309556 | 0) << 23 | b >>> 9) + n | 0,
        b = ((b += ((n = ((n += ((o = ((o += ((a = ((a += (b ^ n ^ o) + e[1] - 1530992060 | 0) << 4 | a >>> 28) + b | 0) ^ b ^ n) + e[4] + 1272893353 | 0) << 11 | o >>> 21) + a | 0) ^ a ^ b) + e[7] - 155497632 | 0) << 16 | n >>> 16) + o | 0) ^ o ^ a) + e[10] - 1094730640 | 0) << 23 | b >>> 9) + n | 0,
        b = ((b += ((n = ((n += ((o = ((o += ((a = ((a += (b ^ n ^ o) + e[13] + 681279174 | 0) << 4 | a >>> 28) + b | 0) ^ b ^ n) + e[0] - 358537222 | 0) << 11 | o >>> 21) + a | 0) ^ a ^ b) + e[3] - 722521979 | 0) << 16 | n >>> 16) + o | 0) ^ o ^ a) + e[6] + 76029189 | 0) << 23 | b >>> 9) + n | 0,
        b = ((b += ((n = ((n += ((o = ((o += ((a = ((a += (b ^ n ^ o) + e[9] - 640364487 | 0) << 4 | a >>> 28) + b | 0) ^ b ^ n) + e[12] - 421815835 | 0) << 11 | o >>> 21) + a | 0) ^ a ^ b) + e[15] + 530742520 | 0) << 16 | n >>> 16) + o | 0) ^ o ^ a) + e[2] - 995338651 | 0) << 23 | b >>> 9) + n | 0,
        b = ((b += ((o = ((o += (b ^ ((a = ((a += (n ^ (b | ~o)) + e[0] - 198630844 | 0) << 6 | a >>> 26) + b | 0) | ~n)) + e[7] + 1126891415 | 0) << 10 | o >>> 22) + a | 0) ^ ((n = ((n += (a ^ (o | ~b)) + e[14] - 1416354905 | 0) << 15 | n >>> 17) + o | 0) | ~a)) + e[5] - 57434055 | 0) << 21 | b >>> 11) + n | 0,
        b = ((b += ((o = ((o += (b ^ ((a = ((a += (n ^ (b | ~o)) + e[12] + 1700485571 | 0) << 6 | a >>> 26) + b | 0) | ~n)) + e[3] - 1894986606 | 0) << 10 | o >>> 22) + a | 0) ^ ((n = ((n += (a ^ (o | ~b)) + e[10] - 1051523 | 0) << 15 | n >>> 17) + o | 0) | ~a)) + e[1] - 2054922799 | 0) << 21 | b >>> 11) + n | 0,
        b = ((b += ((o = ((o += (b ^ ((a = ((a += (n ^ (b | ~o)) + e[8] + 1873313359 | 0) << 6 | a >>> 26) + b | 0) | ~n)) + e[15] - 30611744 | 0) << 10 | o >>> 22) + a | 0) ^ ((n = ((n += (a ^ (o | ~b)) + e[6] - 1560198380 | 0) << 15 | n >>> 17) + o | 0) | ~a)) + e[13] + 1309151649 | 0) << 21 | b >>> 11) + n | 0,
        b = ((b += ((o = ((o += (b ^ ((a = ((a += (n ^ (b | ~o)) + e[4] - 145523070 | 0) << 6 | a >>> 26) + b | 0) | ~n)) + e[11] - 1120210379 | 0) << 10 | o >>> 22) + a | 0) ^ ((n = ((n += (a ^ (o | ~b)) + e[2] + 718787259 | 0) << 15 | n >>> 17) + o | 0) | ~a)) + e[9] - 343485551 | 0) << 21 | b >>> 11) + n | 0,
        t[0] = a + t[0] | 0,
        t[1] = b + t[1] | 0,
        t[2] = n + t[2] | 0,
        t[3] = o + t[3] | 0
}
function c(s: string) {
    var i: number, t: number, e: any[], r: number | string[], c: number, l: number, d = s.length, h = [1732584193, -271733879, -1732584194, 271733878];
    for (i = 64; i <= d; i += 64)
        n(h, o(s.substring(i - 64, i)));
    for (t = (s = s.substring(i - 64)).length,
        e = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        i = 0; i < t; i += 1)
        e[i >> 2] |= s.charCodeAt(i) << (i % 4 << 3);
    if (e[i >> 2] |= 128 << (i % 4 << 3),
        i > 55)
        for (n(h, e),
            i = 0; i < 16; i += 1)
            e[i] = 0;
    return r = (r = 8 * d).toString(16).match(/(.*?)(.{0,8})$/),
        c = parseInt(r[2], 16),
        l = parseInt(r[1], 16) || 0,
        e[14] = c,
        e[15] = l,
        n(h, e),
        h
}
function o(s: string) {
    var i: number, t = [];
    for (i = 0; i < 64; i += 4)
        t[i >> 2] = s.charCodeAt(i) + (s.charCodeAt(i + 1) << 8) + (s.charCodeAt(i + 2) << 16) + (s.charCodeAt(i + 3) << 24);
    return t
}

function y(t: string) {
    var e: number, n = [], o = t.length;
    for (e = 0; e < o - 1; e += 2)
        n.push(parseInt(t.substr(e, 2), 16));
    return String.fromCharCode.apply(String, n)
}

export class x {
    public static hash(password: string, anyChar?: boolean) {
        return x.hashBinary(f(password), anyChar);
    }

    public static hashBinary(content: string, anyChar?: boolean) {
        let e = h(c(content));
        return anyChar ? y(e) : e;
    }
}

export function encrypt(password: string, anyChar?: boolean) {
    return x.hash(password, anyChar);
}